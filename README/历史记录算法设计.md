# 历史记录算法设计

## 1、目的

为了实现谱面编辑器中的一项功能“撤销与恢复”。

目标：

1. 当用户进行一项更改文件的操作时，记录操作
2. 当用户按下Ctrl + z或点击撤销按钮时，回到上一个操作。（不删除之后的操作）
3. 当用户在之前的操作下进行新的操作，删除之后的操作并记录新的。
4. 提供一个像PhotoShop一样的历史记录面板，便于管理。

## 2、实现

首先，这种回溯式的过程当然要用到“栈”，只可惜python中没有自带这一数据类型。那就自己写一个适合该需求的类。我在这里将其命名为History。

此外，我还需要知道这个编辑器将来会有那些操作以及他们对应的反向操作。

1. 添加note --- 删除note
2. 更改note种类 -- 更改note种类
3. 改变note所在时间 -- 改变note所在时间
4. 粘贴一组note -- 删除一组note
5. 更改一组note种类 -- 同
6. 改变一组note所在时间 -- 同
7. 改变note生成位置 -- 同
8. 改变note速度 -- 同

9. ...

*暂时就这些，以后还需要添加。添加就代表着要有一定的延展性。*

之后，我们还需要往History.history[]中添加数据。

在这里，我用tuple来存储一个历史记录。以添加操作为例：

```python
temp = (append, [Arrow()])
```

其中，append是添加函数，我直接把函数（内存地址）存储起来。

Arrow()表示添加的note对象。

在这里，无论有几个参数，都需要加上一个[]表明这是一个列表。

